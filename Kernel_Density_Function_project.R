x <- c(5.60,1.90,3.40,2.25,1.10,6.75,1.50,0.80,2.10,1.20,2.50,5.10,6.05,2.40,3.20,5.60,1.65,6.25,6.50,6.90,1.00,0.50,0.90,1.25,6.75,1.25,6.50,5.50,1.30,6.75,6.40,3.05,6.80,6.60,4.50,0.65,2.30,0.75,1.40,6.50,1.15,6.25,4.50,4.00,0.80,5.00,1.75,0.30,6.50,3.25,1.00,1.75,4.45,5.80,0.95,4.85,5.55,6.90,1.00,2.00,0.15,2.25,0.50,0.60,2.20,3.50,1.50,2.15,3.25,6.25,0.25,5.85,6.15,6.30,0.75,6.10,5.50,5.80,0.50,5.75,0.40,6.25,1.20,2.30,2.40,2.40,2.50,6.25,6.00,5.00,1.50,-0.40,1.75,5.60,2.75,2.50,3.00,1.35)

y <- c(1.85,0.15,2.10,1.15,0.90,0.15,0.60,0.60,1.40,1.50,0.15,1.60,2.15,1.85,1.50,1.90,0.15,0.15,0.15,0.15,0.15,0.25,0.60,1.80,0.95,0.85,1.10,1.25,2.00,0.50,0.15,1.90,0.50,0.60,1.00,0.15,2.00,0.75,2.10,1.25,1.00,0.15,0.40,1.10,0.15,1.25,0.80,0.15,0.60,1.90,0.15,1.50,2.00,0.15,1.50,1.45,0.15,0.15,0.15,0.60,0.15,0.80,0.15,0.15,0.90,1.50,1.25,1.50,2.00,1.40,0.50,1.05,0.80,1.50,0.55,0.40,0.65,0.75,0.35,0.75,0.15,0.40,0.15,0.25,0.15,1.25,2.75,1.00,0.15,0.30,0.25,0.15,0.15,0.80,0.50,0.15,0.55,1.50)

XY <- cbind(x,y)

plot(XY)
abline(h=2.44, v=7.32, col="red")
abline(h=0, v=0, col="red")

h_x=0.75
h_y=0.5
n=length(x) # which is equal to length(y)
n

kernel<-function(x, y, h_x, h_y, x_i, y_i){
    summe <- 0
    for (i in 1:length(x_i)) {
      local_x <- (x - x_i[i])/h_x
      k_x <- ((2*pi)**(-1/2)) * exp((-local_x**2)/2)
      local_y <- (y - y_i[i])/h_y
      k_y <- ((2*pi)**(-1/2)) * exp((-local_y**2)/2)
      summe = summe + k_x*k_y
    }  
    return(summe/(h_x*h_y*length(x_i)))
  }
  
kernel(x,y,h_x,h_y,x,y)
  

kde <- data.frame(x=x,y=y,z=z)
  
library(MASS)
h <- c(h_x, h_y)
density<-kde2d(x,y,h, n=n)
filled.contour(density,color.palette=colorRampPalette(c('white','blue','purple','red','darkred')))

library(plotly)
plot_ly(data=kde,x=x,y=y,z=z, type="mesh3d")
